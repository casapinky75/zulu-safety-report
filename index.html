<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZULU Safety Hub - Reporte CASP</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <style>
        :root {
            --zulu-purple: #4a2c73;
            --zulu-light-purple: #f3f0f7;
            --zulu-white: #ffffff;
            --zulu-accent: #6c4e97;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--zulu-light-purple);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .phone-container {
            width: 375px;
            height: 750px;
            background: var(--zulu-white);
            border-radius: 40px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            overflow-y: auto;
            border: 8px solid #333;
            position: relative;
        }

        header {
            background-color: var(--zulu-purple);
            color: white;
            padding: 40px 20px 20px;
            text-align: center;
            border-bottom-left-radius: 25px;
            border-bottom-right-radius: 25px;
        }

        .form-container {
            padding: 20px;
        }

        h2 {
            color: var(--zulu-purple);
            font-size: 1.2rem;
            margin-bottom: 20px;
            border-left: 4px solid var(--zulu-purple);
            padding-left: 10px;
        }

        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
            color: #555;
            font-size: 0.9rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 0.95rem;
        }

        textarea {
            height: 80px;
            resize: none;
        }

        .confidential-box {
            display: flex;
            align-items: center;
            margin-top: 15px;
            background: #eee;
            padding: 10px;
            border-radius: 8px;
        }

        .confidential-box input {
            width: auto;
            margin-top: 0;
            margin-right: 10px;
        }

        button {
            width: 100%;
            background-color: var(--zulu-purple);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 25px;
            transition: background 0.3s;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .status-msg {
            display: none;
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>

<div class="phone-container">
    <header>
        <div style="font-size: 24px; font-weight: bold; letter-spacing: 2px;">ZULU</div>
        <div style="font-size: 10px; letter-spacing: 3px; margin-top: -5px;">AERONAUTICS</div>
        <p style="font-size: 0.8rem; opacity: 0.8;">Safety Management System (SMS)</p>
    </header>

    <div class="form-container">
        <h2>Reporte de Peligro CASP</h2>
        
        <form id="caspForm">
            <label>Fecha del Reporte</label>
            <input type="date" id="fecha" required>

            <label>Número de Vuelo</label>
            <input type="text" id="vuelo" placeholder="Ej: ZU7260" required>

            <label>Matrícula de Aeronave</label>
            <select id="matricula" required>
                <option value="">Seleccione matrícula...</option>
                <option value="HK-5001">HK-5001 (ZULU 1)</option>
                <option value="HK-5002">HK-5002 (ZULU 2)</option>
                <option value="HK-5003">HK-5003 (ZULU 3)</option>
            </select>

            <label>Fase de Vuelo</label>
            <select id="fase" required>
                <option value="">Seleccione fase...</option>
                <option value="Pre-vuelo">Pre-vuelo / Abordaje</option>
                <option value="Despegue">Despegue</option>
                <option value="Crucero">Crucero</option>
                <option value="Aterrizaje">Aterrizaje / Rodaje</option>
            </select>

            <label>Descripción del Peligro</label>
            <textarea id="descripcion" placeholder="Describa el peligro identificado..." required></textarea>

            <label>Acción Inmediata Tomada</label>
            <textarea id="accion" placeholder="¿Qué medidas tomó?" required></textarea>

            <label>Nombre del Reportante</label>
            <input type="text" id="reportante" placeholder="Nombre completo (Opcional)">

            <label>Correo Electrónico</label>
            <input type="email" id="email_usuario" placeholder="usuario@ejemplo.com" required>

            <div class="confidential-box">
                <input type="checkbox" id="confidential">
                <label for="confidential" style="margin-top:0;">¿Reporte confidencial?</label>
            </div>

            <button type="button" id="btnEnviar" onclick="sendMail()">ENVIAR REPORTE AHORA</button>
            <p id="msg" class="status-msg"></p>
        </form>
    </div>
</div>

<script>
    // 2. INICIALIZAR CON TU PUBLIC KEY
    emailjs.init("obpRrXaR-XMG-erkK");

    // Fecha por defecto
    document.getElementById('fecha').valueAsDate = new Date();

    function sendMail() {
        const btn = document.getElementById('btnEnviar');
        const msg = document.getElementById('msg');

        // Captura de datos para enviar a la plantilla
        const params = {
            fecha: document.getElementById('fecha').value,
            vuelo: document.getElementById('vuelo').value,
            matricula: document.getElementById('matricula').value,
            fase: document.getElementById('fase').value,
            descripcion: document.getElementById('descripcion').value,
            accion: document.getElementById('accion').value,
            reportante: document.getElementById('reportante').value || "Anónimo",
            email_usuario: document.getElementById('email_usuario').value, // Enviar el correo
            confidencial: document.getElementById('confidential').checked ? "SÍ" : "NO"
        };

        // Validación simple de campos obligatorios
        if(!params.vuelo || !params.descripcion || !params.fase || !params.email_usuario) {
            alert("Por favor, completa todos los campos obligatorios, incluyendo tu correo.");
            return;
        }

        // Estado de carga
        btn.disabled = true;
        btn.innerText = "ENVIANDO...";
        msg.style.display = "block";
        msg.innerText = "⏳ Procesando envío seguro...";
        msg.style.color = "#4a2c73";

        // 3. ENVÍO REAL USANDO TUS CREDENCIALES
        emailjs.send("service_26uu33j", "template_1oihidd", params)
            .then(function() {
                msg.innerText = "✅ ¡Reporte enviado con éxito al SMS!";
                msg.style.color = "green";
                btn.innerText = "ENVIADO";
                btn.style.backgroundColor = "#28a745";
                
                // Limpiar formulario tras éxito
                setTimeout(() => {
                    document.getElementById('caspForm').reset();
                    document.getElementById('fecha').valueAsDate = new Date();
                    btn.disabled = false;
                    btn.innerText = "ENVIAR REPORTE AHORA";
                    btn.style.backgroundColor = "#4a2c73";
                    msg.style.display = "none";
                }, 4000);

            }, function(error) {
                msg.innerText = "❌ Error en el servidor. Intenta de nuevo.";
                msg.style.color = "red";
                btn.disabled = false;
                btn.innerText = "REINTENTAR ENVÍO";
                console.error("Fallo EmailJS:", error);
            });
    }
</script>

</body>
</html>
